var e=function(e){var t=e.reduce((function(e,t){return e+t}),0);return 0===e.length?-1:t/e.length},t=function(){function t(){var e,t,n,i=this;this.measureBW=function(e,t){var n=i.utils,r=n.getCurrentTime,a=n.measureBWSimple;!function n(i){var s=r();a({t:Math.random()}).then((function(a){var o=a.length/((r()-s)/1e3)/1024;e&&i&&e(Math.floor(o)),i>=t||n(++i)})).catch((function(e){}))}(0)},this.eventPresent=function(e){if(e){["preventDefault","stopPropagation"].forEach((function(t){return e[t]&&e[t]()})),e.cancelBubble=!0}},this.measureDelay=function(e,t){var n=i.utils,r=n.getCurrentTime,a=n.tryCatchFunc;t=t||1;var s=0,o="//webcdn.inke.cn/edith.cn/hm.gif?",u=new Image;u.onerror=a(i.eventPresent),u.onload=function n(){var u=r(),c=new Image;c.onload=function(){var i=r()-u;s++,e(i),s<t&&setTimeout(n,1e3)},c.src=o+Math.random(),c.onerror=a(i.eventPresent)},u.src=o+Math.random()},this.name="network",this.state={speed:-1,delays:-1,netWorkType:(e=navigator,t="connection",n="effectiveType",e[t]&&e[t][n]?e[t][n]:"")},this.speeds=[],this.delays=[]}var n=t.prototype;return n.checkNetSpeed=function(){var e=this,t=function(){var e=navigator,t="connection",n="downlink";if(e[t]&&e[t][n])return 1024*e[t][n]/8}();if(t)return this.speeds.push(t);this.measureBW((function(t){return e.speeds.push(t)}),1)},n.checkDelay=function(){var e=this;this.measureDelay((function(t){return e.delays.push(t)}),4)},n.startCheck=function(){var e=window.requestIdleCallback;if(!e)return setTimeout(this.checkDelay.bind(this),6e3*Math.random()+1e3),setTimeout(this.checkNetSpeed.bind(this),7e3*Math.random()+1200);var t=[this.checkDelay.bind(this),this.checkNetSpeed.bind(this)];e((function n(i){for(;(i.timeRemaining()>0||i.didTimeout)&&t.length>0;)t.shift()();t.length>0&&e(n)}),{timeout:7e3})},n.apply=function(t){var n=this;t(n.name,(function(t,i){var r=t.state,a=t.utils;n.utils=a,r[n.name]||n.startCheck.apply(n);var s=n.state.netWorkType;i({speed:e(n.speeds),delay:e(n.delays),netWorkType:s})}))},t}();export default t;
//# sourceMappingURL=NetworkCheckPlugin-bb9f9667.js.map
